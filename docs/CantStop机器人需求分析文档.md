# 📋 CantStop 贪骰无厌机器人需求分析文档

## 🎯 项目概述

### 项目名称
**CantStop 贪骰无厌企划群机器人**

### 项目目标
基于"Can't Stop贪骰无厌"游戏规则，搭建可供企划群友多人使用的骰子机器人系统，实现完整的游戏流程管理、进度记录、随机事件触发等功能。

### 目标用户
- 企划群成员
- 多人在线游戏玩家
- 需要积分管理和打卡系统的用户群体

---

## 🎲 核心游戏规则

### 基础游戏机制

#### 游戏工具
- 1张游戏地图（16列，每列格子数量3-10不等）
- 6个6面骰子
- 每玩家3个临时标记
- 永久棋子进度记录系统

#### 胜利条件
🏆 **玩家在任意3列上登顶即可获胜**

### 游戏流程

#### 阶段1：投掷阶段
1. **积分消耗**：每回合消耗10积分
2. **掷骰规则**：进行6次6面骰投掷（6d6）
3. **数值组合**：将6个结果分为两组（3+3），分别相加得到两个最终数字
4. **组合限制**：每个数字只能使用一次

**示例：**
```
投掷结果：2, 3, 3, 4, 5, 6
可选组合：
- 组合A：2+3+5=10，组合B：3+4+6=13
- 组合A：2+4+6=12，组合B：3+3+5=11
```

#### 阶段2：移动指示物阶段
1. **标记放置**：根据最终数字在对应列放置临时标记
2. **进度叠加**：有记录进度时从当前进度+1开始
3. **数量限制**：最多同时放置3个临时标记
4. **唯一性**：每列只能有1个临时标记

#### 阶段3：决策阶段
**主动停止：**
- 撤回所有临时标记
- 记录当前进度为永久进度
- **必须完成打卡**才能开始下一轮

**继续投掷：**
- 重复投掷和移动阶段
- 风险：可能触发被动停止

**被动停止（失败）：**
- 触发条件：无法移动任何临时标记且已放置3个标记
- 后果：清空本轮所有未记录进度

### 特殊规则

1. **首轮规则**：必须使用两个最终数字放置两个临时标记
2. **次轮规则**：可以只选择一个数字放置一个临时标记
3. **强制移动**：每回合必须移动所有能移动的临时标记
4. **登顶限制**：不能在已完成的列上再次放置标记

---

## 🗺️ 地图系统设计

### 地图结构

```json
{
    "列号": "格子数量",
    "3": 3,   "4": 4,   "5": 5,   "6": 6,   "7": 7,   "8": 8,
    "9": 9,   "10": 10, "11": 10, "12": 9,  "13": 8,  "14": 7,
    "15": 6,  "16": 5,  "17": 4,  "18": 3
}
```

### 地图内容物

#### 🕳️ 陷阱系统
1. **小小火球术**（小数字列陷阱）
2. **"不要回头"**（通用陷阱）
3. **河..土地神**（互动选择陷阱）
4. **花言巧语**（策略陷阱）

#### 🎁 道具系统
- 首次触发获得道具
- 可选择保留或半价出售
- 后续玩家获得+10积分
- 阵营限制道具

#### 🎭 遭遇事件
- 普通事件类型
- 解锁后打卡获得5积分
- 每个事件限制一次

---

## 💰 积分系统

### 积分获得方式

| 获得途径 | 积分数量 | 说明 |
|---------|---------|------|
| **草图** | +20 | 杂线较多/简单小图 |
| **精致小图** | +80 | 精致但篇幅不大的图 |
| **精草大图** | +100 | 有点草的整页作品 |
| **精致大图** | +150 | 精致的整页作品 |
| **超常发挥** | +30 | 额外奖励 |
| **地图奖励** | 变动 | 根据位置不同 |
| **遭遇事件** | +5 | 解锁后打卡 |

### 积分消耗项目

| 消耗项目 | 积分数量 | 说明 |
|---------|---------|------|
| **掷骰** | -10 | 每回合固定消耗 |
| **陷阱惩罚** | -10 | 后续触发陷阱 |
| **道具购买** | 变动 | 根据道具类型 |

---

## 🤖 机器人功能需求

### 核心功能需求

#### 1. 游戏流程管理
- ✅ **轮次控制**：开始/结束轮次管理
- ✅ **掷骰功能**：6d6投掷和结果显示
- ✅ **数值记录**：玩家选择数值组合记录
- ✅ **进度追踪**：临时标记和永久进度管理
- ✅ **状态查询**：当前游戏状态显示

#### 2. 进度记录系统
- ✅ **临时标记追踪**：当前位置和剩余标记数
- ✅ **永久进度保存**：跨轮次进度记录
- ✅ **登顶检测**：自动检测登顶和胜利条件
- ✅ **多玩家支持**：独立的玩家进度管理

#### 3. 错误检测和提醒
- ✅ **移动验证**：检测是否有可移动标记
- ✅ **数值验证**：验证输入数值的有效性
- ✅ **规则提醒**：违规操作的友好提示
- ✅ **状态检查**：游戏状态一致性验证

#### 4. 随机事件系统
- ✅ **位置触发**：到达特定位置触发事件
- ✅ **阵营区分**：根据阵营提供不同事件
- ✅ **首达记录**：记录首次完成列的玩家
- ✅ **奖励发放**：自动发放额外奖励

#### 5. 阵营系统
- ✅ **阵营选择**：收养人/Aeonreth阵营
- ✅ **差异化内容**：阵营特定的事件和道具
- ✅ **限制管理**：阵营道具使用限制

#### 6. 首达奖励系统
- ✅ **记录追踪**：每列首次登顶玩家记录
- ✅ **奖励发放**：首达玩家额外奖励
- ✅ **排除重复**：避免重复发放奖励

### 扩展功能需求

#### 7. 积分管理系统
- ✅ **积分追踪**：玩家积分实时记录
- ✅ **打卡集成**：作品打卡积分获得
- ✅ **消耗记录**：游戏过程积分消耗

#### 8. 道具商店系统
- ✅ **商店管理**：道具展示和购买
- ✅ **库存控制**：道具使用次数限制
- ✅ **动态上架**：地图道具自动上架

#### 9. 成就系统
- ✅ **隐藏成就**：特殊条件触发的成就
- ✅ **奖励发放**：成就解锁奖励
- ✅ **进度追踪**：成就解锁条件监控

---

## 🎯 用户交互指令

### 游戏流程指令

| 指令格式 | 功能 | 说明 |
|---------|------|------|
| `选择阵营：xxx` | 选择游戏阵营 | xxx为收养人/Aeonreth |
| `轮次开始` | 开始新轮次 | 初始化轮次状态 |
| `.r6d6` | 掷骰子 | 消耗10积分进行投掷 |
| `a,b` | 记录双数值 | 移动两个临时标记 |
| `a` | 记录单数值 | 移动一个临时标记 |
| `替换永久棋子` | 主动结束轮次 | 保存进度，需要打卡 |
| `查看当前进度` | 查看游戏状态 | 显示当前位置和进度 |
| `打卡完毕` | 恢复游戏功能 | 打卡后继续游戏 |

### 奖励系统指令

| 指令格式 | 功能 | 积分奖励 |
|---------|------|----------|
| `领取（类型）奖励n` | 普通打卡奖励 | 20-150积分 |
| `我超级满意这张图n` | 超常发挥奖励 | 额外+30积分 |

### 商店系统指令

| 指令格式 | 功能 | 说明 |
|---------|------|------|
| `道具商店` | 查看商店 | 显示可购买道具 |
| `购买xxx` | 购买道具 | 消耗积分获得道具 |
| `使用xxx` | 使用道具 | 触发道具效果 |
| `添加xxx到道具商店` | 上架道具 | 解锁后添加到商店 |

---

## 🔧 技术实现要求

### 数据存储需求

#### 玩家数据结构
```json
{
    "player_id": "用户ID",
    "faction": "阵营",
    "current_score": "当前积分",
    "permanent_progress": {
        "列号": "进度值"
    },
    "temporary_markers": {
        "列号": "当前位置"
    },
    "completed_columns": ["已完成列号"],
    "achievements": ["已解锁成就"],
    "inventory": ["拥有道具"]
}
```

#### 游戏状态数据
```json
{
    "game_id": "游戏ID",
    "current_turn_player": "当前回合玩家",
    "turn_state": "轮次状态",
    "dice_results": [1, 2, 3, 4, 5, 6],
    "first_completion_records": {
        "列号": "首次完成玩家ID"
    },
    "unlocked_items": ["已解锁道具列表"]
}
```

### 核心算法需求

#### 1. 骰子组合验证算法
- 验证6个数字分组的有效性
- 计算所有可能的组合方案
- 检查组合结果的可用性

#### 2. 移动有效性检测
- 检查临时标记是否可以移动
- 验证新标记放置的合法性
- 判断被动停止条件

#### 3. 事件触发系统
- 位置到达检测
- 阵营匹配验证
- 首达状态判断

### 性能要求

- **响应时间**：指令响应 < 2秒
- **并发支持**：支持50+用户同时游戏
- **数据一致性**：确保多玩家数据同步
- **错误恢复**：异常情况下的数据恢复

---

## 🎮 用户体验设计

### 界面友好性

#### 1. 清晰的状态显示
```
当前位置：第10列-进度3, 第12列-进度1
剩余可放置标记：1
当前永久棋子位置：第7列-进度5, 第10列-进度3, 第12列-进度1
已登顶棋子数：0/3
```

#### 2. 友好的错误提示
```
❌ 检测到您仍有可放置/移动的临时标记，请进行移动。
❌ 检测到您当前数值无法移动，请重新设置。
✅ 您可以开始新的轮次了～
```

#### 3. 丰富的反馈信息
```
🎲 好了好了，我要摇了...
<玩家名>的骰点: 1 2 3 4 5 6
-还算可以吧

🏆 恭喜您在第10列登顶～
已清空该列场上所有临时标记。
```

### 游戏平衡性

#### 风险回报平衡
- 短列高风险高回报（3格列）
- 长列低风险稳定推进（10格列）
- 中等列平衡选择（7-9格列）

#### 积分经济平衡
- 打卡获得积分 vs 游戏消耗积分
- 道具价格 vs 道具效果价值
- 奖励激励 vs 惩罚平衡

---

## 🚀 开发里程碑

### 第一阶段：核心功能（MVP）
- [x] 基础游戏流程实现
- [x] 玩家进度记录系统
- [x] 基本指令处理
- [x] 错误检测和提醒

### 第二阶段：扩展功能
- [x] 随机事件系统
- [x] 阵营系统实现
- [x] 首达奖励机制
- [x] 积分管理系统

### 第三阶段：完善优化
- [x] 道具商店系统
- [x] 成就系统
- [x] 用户体验优化
- [x] 性能优化和测试

### 第四阶段：部署维护
- [ ] 生产环境部署
- [ ] 监控和日志系统
- [ ] 用户反馈收集
- [ ] 持续功能迭代

---

## ✅ 验收标准

### 功能完整性
- ✅ 所有游戏规则正确实现
- ✅ 所有用户指令正常响应
- ✅ 多玩家并发游戏无冲突
- ✅ 数据持久化和恢复

### 用户体验
- ✅ 界面友好，信息清晰
- ✅ 错误提示准确有用
- ✅ 游戏流程顺畅自然
- ✅ 学习成本合理

### 系统稳定性
- ✅ 无重大bug和崩溃
- ✅ 数据一致性保证
- ✅ 异常处理完善
- ✅ 性能满足要求

### 可维护性
- ✅ 代码结构清晰
- ✅ 文档完整详细
- ✅ 易于扩展新功能
- ✅ 便于故障排查

---

## 📝 附录

### 参考文档
- [游戏规则说明书](./游戏规则说明书.md)
- [机器人指令完整手册](./机器人指令完整手册.md)
- [陷阱与成就系统详解](./陷阱与成就系统详解.md)

### 联系信息
- **项目负责人**：企划组
- **技术支持**：开发团队
- **用户反馈**：企划群管理员

---

*本需求文档将随着项目进展持续更新和完善。* 📋✨
