# Can't Stop æ¸¸æˆä½¿ç”¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### è¿è¡ŒCLIç•Œé¢

```bash
# Windowsç”¨æˆ·ï¼ˆæ¨èï¼‰
set PYTHONIOENCODING=utf-8
python main.py --interface cli --demo  # æ¼”ç¤ºæ¨¡å¼
python main.py --interface cli         # æ­£å¸¸æ¸¸æˆ

# Linux/Macç”¨æˆ·
export PYTHONIOENCODING=utf-8
python main.py --interface cli --demo  # æ¼”ç¤ºæ¨¡å¼
python main.py --interface cli         # æ­£å¸¸æ¸¸æˆ
```

### è¿è¡ŒGUIç•Œé¢

```bash
# éœ€è¦å…ˆå®‰è£…PySide6
pip install PySide6

# Windowsç”¨æˆ·
set PYTHONIOENCODING=utf-8
python main.py --interface gui

# Linux/Macç”¨æˆ·
export PYTHONIOENCODING=utf-8
python main.py --interface gui
```

## ğŸ® æ¸¸æˆç©æ³•

### 1. æ³¨å†Œç©å®¶

åœ¨CLIä¸­è¾“å…¥ï¼š
```
register <ç”¨æˆ·å> <é˜µè¥>
```

ç¤ºä¾‹ï¼š
```
register å¼ ä¸‰ æ”¶å…»äºº
register æå›› Aonreth
```

### 2. å¼€å§‹æ¸¸æˆ

```
start
```

### 3. æ¸¸æˆæµç¨‹

#### æ·éª°å­
```
roll
# æˆ–
æ·éª°
# æˆ–
.r6d6
```

æ¯æ¬¡æ·éª°æ¶ˆè€—10ç§¯åˆ†ï¼Œå¾—åˆ°6ä¸ª1-6çš„éšæœºæ•°ã€‚

#### é€‰æ‹©æ•°å€¼ç»„åˆ

å°†6ä¸ªæ•°å­—åˆ†ä¸ºä¸¤ç»„ï¼ˆæ¯ç»„3ä¸ªï¼‰ï¼Œåˆ†åˆ«ç›¸åŠ å¾—åˆ°ä¸¤ä¸ªæ•°å­—ï¼š

```
8,13      # åŒæ•°å€¼ç»„åˆ
10        # å•æ•°å€¼ç»„åˆ
```

#### ç»§ç»­æˆ–ç»“æŸ

- ç»§ç»­æŠ•æ·ï¼š`continue` æˆ– `ç»§ç»­`
- ç»“æŸå›åˆï¼š`end` æˆ– `æ›¿æ¢æ°¸ä¹…æ£‹å­`

#### å®Œæˆæ‰“å¡

ä¸»åŠ¨ç»“æŸå›åˆåéœ€è¦æ‰“å¡ï¼š
```
checkin
# æˆ–
æ‰“å¡å®Œæ¯•
```

### 4. æŸ¥çœ‹çŠ¶æ€

```
status          # æŸ¥çœ‹æ¸¸æˆçŠ¶æ€
progress        # æŸ¥çœ‹å½“å‰è¿›åº¦
æŸ¥çœ‹å½“å‰è¿›åº¦     # ä¸­æ–‡æŒ‡ä»¤
```

### 5. ç§¯åˆ†ç®¡ç†

```bash
# ä¸åŒç±»å‹çš„ä½œå“å¥–åŠ±
add_score è‰å›¾           # +20ç§¯åˆ†
add_score ç²¾è‡´å°å›¾       # +80ç§¯åˆ†
add_score ç²¾è‰å¤§å›¾       # +100ç§¯åˆ†
add_score ç²¾è‡´å¤§å›¾       # +150ç§¯åˆ†
add_score è¶…å¸¸å‘æŒ¥       # +30ç§¯åˆ†
```

### 6. æŸ¥çœ‹æ’è¡Œæ¦œ

```
leaderboard
# æˆ–
æ’è¡Œæ¦œ
```

## ğŸ¯ æ¸¸æˆè§„åˆ™è¯¦è§£

### åŸºæœ¬è§„åˆ™

1. **ç›®æ ‡**ï¼šåœ¨ä»»æ„3åˆ—ä¸Šç™»é¡¶å³å¯è·èƒœ
2. **åœ°å›¾**ï¼š16åˆ—ï¼ˆ3-18ï¼‰ï¼Œæ¯åˆ—é•¿åº¦ä¸åŒ
3. **æ ‡è®°**ï¼šæ¯ç©å®¶æœ€å¤šåŒæ—¶ä½¿ç”¨3ä¸ªä¸´æ—¶æ ‡è®°
4. **ç§¯åˆ†**ï¼šæ¯å›åˆæ¶ˆè€—10ç§¯åˆ†æ·éª°

### åˆ—é•¿åº¦åˆ†å¸ƒ

```
åˆ—å·:  3  4  5  6  7  8  9  10 11 12 13 14 15 16 17 18
é•¿åº¦:  3  4  5  6  7  8  9  10 10  9  8  7  6  5  4  3
```

### ç‰¹æ®Šè§„åˆ™

- **é¦–è½®è§„åˆ™**ï¼šå¿…é¡»é€‰æ‹©ä¸¤ä¸ªæ•°å€¼æ”¾ç½®ä¸¤ä¸ªæ ‡è®°
- **ç§»åŠ¨å¼ºåˆ¶**ï¼šæ¯å›åˆå¿…é¡»ç§»åŠ¨æ‰€æœ‰èƒ½ç§»åŠ¨çš„æ ‡è®°
- **è¢«åŠ¨åœæ­¢**ï¼šæ— æ³•ç§»åŠ¨ä»»ä½•æ ‡è®°ä¸”å·²æœ‰3ä¸ªæ ‡è®°æ—¶ï¼Œæ¸…ç©ºæ‰€æœ‰è¿›åº¦
- **ç™»é¡¶ä¿æŠ¤**ï¼šå·²å®Œæˆçš„åˆ—æ— æ³•å†æ”¾ç½®æ ‡è®°

### æ¦‚ç‡ç­–ç•¥

#### å®¹æ˜“è¾¾æˆçš„åˆ—
- **ç¬¬10ã€11åˆ—**ï¼š10æ ¼ï¼Œç»„åˆæ•°æœ€å¤šï¼ˆ27ç§ï¼‰
- **ç¬¬7-9ã€12-14åˆ—**ï¼šä¸­ç­‰é•¿åº¦ï¼Œå¹³è¡¡é€‰æ‹©

#### é«˜é£é™©é«˜å›æŠ¥
- **ç¬¬3ã€18åˆ—**ï¼šä»…3æ ¼ï¼Œä½†åªæœ‰1ç§ç»„åˆå¯è¾¾æˆ
- **ç¬¬4ã€17åˆ—**ï¼š4æ ¼ï¼Œ3ç§ç»„åˆ

## ğŸ› ï¸ é«˜çº§åŠŸèƒ½

### é…ç½®æ–‡ä»¶

ç¼–è¾‘ `config/default_config.yaml` è‡ªå®šä¹‰æ¸¸æˆè®¾ç½®ï¼š

```yaml
game:
  dice_cost: 10                    # æ·éª°æ¶ˆè€—
  max_temporary_markers: 3         # æœ€å¤§ä¸´æ—¶æ ‡è®°æ•°
  win_condition_columns: 3         # è·èƒœæ‰€éœ€åˆ—æ•°

  score_rewards:
    è‰å›¾: 20
    ç²¾è‡´å°å›¾: 80
    ç²¾è‰å¤§å›¾: 100
    ç²¾è‡´å¤§å›¾: 150
    è¶…å¸¸å‘æŒ¥: 30
```

### æ•°æ®åº“ç®¡ç†

æ¸¸æˆæ•°æ®é»˜è®¤å­˜å‚¨åœ¨ `cant_stop.db` SQLiteæ–‡ä»¶ä¸­ã€‚

æŸ¥çœ‹æ•°æ®ï¼š
```bash
sqlite3 cant_stop.db
.tables              # æŸ¥çœ‹è¡¨ç»“æ„
SELECT * FROM players;  # æŸ¥çœ‹ç©å®¶æ•°æ®
```

### å¼€å‘æ¨¡å¼

åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ç”¨ï¼š
```yaml
development:
  debug: true
  test_mode: true
  mock_dice: true      # ä½¿ç”¨å›ºå®šéª°å­ç»“æœæµ‹è¯•
```

## ğŸ¤– QQæœºå™¨äººé›†æˆ

### æ¶ˆæ¯å¤„ç†æ¡†æ¶

é¡¹ç›®æä¾›äº†å®Œæ•´çš„æ¶ˆæ¯å¤„ç†æ¡†æ¶ï¼Œæ”¯æŒï¼š

- æŒ‡ä»¤è§£æå’Œè·¯ç”±
- ç”¨æˆ·æƒé™ç®¡ç†
- é¢‘ç‡é™åˆ¶
- é”™è¯¯å¤„ç†

### é›†æˆç¤ºä¾‹

```python
from src.services.message_processor import QQBotAdapter

# åˆ›å»ºé€‚é…å™¨
adapter = QQBotAdapter()

# å¤„ç†ç¾¤æ¶ˆæ¯
async def handle_group_message(user_id, username, group_id, message):
    response = await adapter.handle_group_message(user_id, username, group_id, message)
    return response

# å¤„ç†ç§èŠæ¶ˆæ¯
async def handle_private_message(user_id, username, message):
    response = await adapter.handle_private_message(user_id, username, message)
    return response
```

æ”¯æŒçš„æŒ‡ä»¤æ ¼å¼ï¼š

```python
# æ¸¸æˆæŒ‡ä»¤
"é€‰æ‹©é˜µè¥ï¼šæ”¶å…»äºº"
"è½®æ¬¡å¼€å§‹"
"æ·éª°" / ".r6d6"
"8,13" / "10"
"æ›¿æ¢æ°¸ä¹…æ£‹å­"
"æŸ¥çœ‹å½“å‰è¿›åº¦"
"æ‰“å¡å®Œæ¯•"

# ç§¯åˆ†æŒ‡ä»¤
"é¢†å–è‰å›¾å¥–åŠ±1"
"æˆ‘è¶…çº§æ»¡æ„è¿™å¼ å›¾1"

# æŸ¥è¯¢æŒ‡ä»¤
"æ’è¡Œæ¦œ"
"å¸®åŠ©"
"é“å…·å•†åº—"
```

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
pip install pytest pytest-asyncio

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_game_engine.py -v
pytest tests/test_message_processor.py -v
```

### æµ‹è¯•è¦†ç›–ç‡

```bash
pip install pytest-cov
pytest tests/ --cov=src --cov-report=html
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“é”å®š**
   ```bash
   # åœæ­¢æ‰€æœ‰ç›¸å…³è¿›ç¨‹ï¼Œåˆ é™¤æ•°æ®åº“æ–‡ä»¶é‡æ–°å¼€å§‹
   rm cant_stop.db
   ```

2. **PySide6å®‰è£…å¤±è´¥**
   ```bash
   # Windows
   pip install PySide6 --upgrade

   # Linuxéœ€è¦é¢å¤–ä¾èµ–
   sudo apt-get install python3-pyqt5-dev-tools
   ```

3. **é…ç½®æ–‡ä»¶é”™è¯¯**
   ```bash
   # åˆ é™¤è‡ªå®šä¹‰é…ç½®ï¼Œä½¿ç”¨é»˜è®¤é…ç½®
   rm config/config.yaml
   ```

### æ—¥å¿—æŸ¥çœ‹

æ—¥å¿—é»˜è®¤ä¿å­˜åœ¨ `logs/cant_stop.log`ï¼š

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f logs/cant_stop.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep ERROR logs/cant_stop.log
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–

1. **å®šæœŸæ¸…ç†**ï¼šæ¸¸æˆä¼šè‡ªåŠ¨æ¸…ç†7å¤©å‰çš„å·²å®Œæˆä¼šè¯
2. **ç´¢å¼•ä¼˜åŒ–**ï¼šæ•°æ®åº“å·²é…ç½®é€‚å½“çš„ç´¢å¼•
3. **è¿æ¥æ± **ï¼šä½¿ç”¨è¿æ¥æ± ç®¡ç†æ•°æ®åº“è¿æ¥

### å†…å­˜ç®¡ç†

1. **ä¼šè¯æ¸…ç†**ï¼šåŠæ—¶æ¸…ç†æ— æ•ˆä¼šè¯
2. **ç¼“å­˜ç­–ç•¥**ï¼šåˆç†ä½¿ç”¨ç¼“å­˜å‡å°‘æ•°æ®åº“æŸ¥è¯¢
3. **æ—¥å¿—è½®è½¬**ï¼šè‡ªåŠ¨è½®è½¬æ—¥å¿—æ–‡ä»¶é˜²æ­¢è¿‡å¤§

## ğŸ”’ å®‰å…¨è€ƒè™‘

### æ•°æ®å®‰å…¨

- ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢SQLæ³¨å…¥
- è¾“å…¥éªŒè¯å’Œæ¸…ç†
- è®¿é—®æƒé™æ§åˆ¶

### é¢‘ç‡é™åˆ¶

é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼š
```yaml
security:
  rate_limiting:
    enabled: true
    max_requests_per_minute: 30
```

### æ•°æ®å¤‡ä»½

è‡ªåŠ¨å¤‡ä»½åŠŸèƒ½ï¼š
```yaml
security:
  backup:
    enabled: true
    interval_hours: 6
    max_backups: 10
```

## ğŸ¨ è‡ªå®šä¹‰æ‰©å±•

### æ·»åŠ æ–°çš„æ¸¸æˆäº‹ä»¶

åœ¨ `src/core/game_engine.py` ä¸­çš„ `_init_map_events` æ–¹æ³•ä¸­æ·»åŠ ï¼š

```python
events.append({
    "column": 7,
    "position": 4,
    "type": EventType.TRAP,
    "name": "æ–°é™·é˜±"
})
```

### æ·»åŠ æ–°çš„ç§¯åˆ†å¥–åŠ±

åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š
```yaml
game:
  score_rewards:
    æ–°ä½œå“ç±»å‹: 50
```

### è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†

åœ¨ `src/services/message_processor.py` ä¸­æ·»åŠ æ–°çš„å¤„ç†å™¨ï¼š

```python
def _handle_new_command(self, message: UserMessage) -> BotResponse:
    # å¤„ç†æ–°æŒ‡ä»¤
    return BotResponse(content="å¤„ç†ç»“æœ", message_type=MessageType.COMMAND)

# æ³¨å†Œå¤„ç†å™¨
self.command_handlers["æ–°æŒ‡ä»¤"] = self._handle_new_command
```

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼š

1. æŸ¥çœ‹ [æ¸¸æˆè§„åˆ™è¯´æ˜ä¹¦](docs/æ¸¸æˆè§„åˆ™è¯´æ˜ä¹¦.md)
2. å‚è€ƒ [æœºå™¨äººæŒ‡ä»¤æ‰‹å†Œ](docs/æœºå™¨äººæŒ‡ä»¤å®Œæ•´æ‰‹å†Œ.md)
3. æŸ¥çœ‹æµ‹è¯•ç”¨ä¾‹äº†è§£ä½¿ç”¨æ–¹æ³•
4. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶è·å–é”™è¯¯ä¿¡æ¯

ç¥æ‚¨æ¸¸æˆæ„‰å¿«ï¼ğŸ²