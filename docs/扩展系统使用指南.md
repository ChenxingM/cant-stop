# ğŸš€ CantStopæ‰©å±•ç³»ç»Ÿä½¿ç”¨æŒ‡å—

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨æ–°å¢çš„æ‰©å±•ç³»ç»Ÿæ¥æ·»åŠ è‡ªå®šä¹‰æˆå°±å’Œé™·é˜±ï¼ŒåŒæ—¶ä¿æŒç³»ç»Ÿå‘åå…¼å®¹ã€‚

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

### âœ… å·²å®Œæˆçš„æ”¹è¿›

1. **äº‹ä»¶é©±åŠ¨æ¶æ„** - è‡ªåŠ¨æˆå°±æ£€æµ‹
2. **é…ç½®æ–‡ä»¶é©±åŠ¨çš„æˆå°±ç³»ç»Ÿ** - æ— éœ€ä¿®æ”¹ä»£ç 
3. **æ’ä»¶åŒ–é™·é˜±ç³»ç»Ÿ** - æ”¯æŒåŠ¨æ€æ‰©å±•
4. **å‘åå…¼å®¹** - ç°æœ‰åŠŸèƒ½ç»§ç»­æ­£å¸¸å·¥ä½œ

---

## ğŸ† æ·»åŠ æ–°æˆå°±

### æ–¹æ³•1ï¼šé…ç½®æ–‡ä»¶æ·»åŠ ï¼ˆæ¨èï¼‰

1. **ç¼–è¾‘é…ç½®æ–‡ä»¶** `config/achievements.json`ï¼š

```json
{
  "achievements": {
    "your_new_achievement": {
      "name": "ğŸ¯ æ‚¨çš„æ–°æˆå°±",
      "description": "æˆå°±æè¿°",
      "category": "CHALLENGE",
      "reward_description": "å¥–åŠ±æè¿°",
      "conditions": [
        {
          "type": "event_count",
          "event": "column_completed",
          "count": 5,
          "scope": "lifetime"
        }
      ]
    }
  }
}
```

2. **é‡å¯ç³»ç»Ÿ** - æˆå°±ä¼šè‡ªåŠ¨åŠ è½½å¹¶å¼€å§‹æ£€æµ‹

### æ”¯æŒçš„æ¡ä»¶ç±»å‹

- **event_count**: äº‹ä»¶è®¡æ•°
  ```json
  {
    "type": "event_count",
    "event": "player_died",  // äº‹ä»¶ç±»å‹
    "count": 3,              // è§¦å‘æ¬¡æ•°
    "scope": "lifetime"      // èŒƒå›´ï¼šlifetime/session
  }
  ```

- **trap_triggered**: é™·é˜±è§¦å‘
  ```json
  {
    "type": "trap_triggered",
    "trap_name": "å°å°ç«çƒæœ¯"
  }
  ```

- **single_turn_complete**: å•å›åˆé€šå…³
  ```json
  {
    "type": "single_turn_complete"
  }
  ```

### æ–¹æ³•2ï¼šä»£ç åŠ¨æ€æ·»åŠ 

```python
from src.core.achievement_manager import AchievementManager

manager = AchievementManager(use_enhanced_system=True)

# æ·»åŠ æ–°æˆå°±
achievement_data = {
    "name": "ğŸ® ä»£ç æˆå°±",
    "description": "é€šè¿‡ä»£ç æ·»åŠ çš„æˆå°±",
    "category": "SPECIAL",
    "reward_description": "ç¼–ç¨‹å¥–åŠ±",
    "conditions": [
        {
            "type": "event_count",
            "event": "dice_rolled",
            "count": 100,
            "scope": "lifetime"
        }
    ]
}

# è¿è¡Œæ—¶æ·»åŠ 
manager.add_achievement_from_config("code_achievement", achievement_data)

# ä¿å­˜åˆ°é…ç½®æ–‡ä»¶
manager.save_achievement_to_config("code_achievement", achievement_data)
```

---

## ğŸ•³ï¸ æ·»åŠ æ–°é™·é˜±

### æ–¹æ³•1ï¼šé…ç½®æ–‡ä»¶æ·»åŠ ï¼ˆæ¨èï¼‰

1. **ç¼–è¾‘é…ç½®æ–‡ä»¶** `config/trap_plugins.json`ï¼š

```json
{
  "plugins": {
    "æ‚¨çš„æ–°é™·é˜±": {
      "plugin_class": "YourNewTrap",
      "name": "æ‚¨çš„æ–°é™·é˜±",
      "description": "é™·é˜±æè¿°",
      "character_quote": "è§’è‰²å°è¯",
      "penalty_description": "æƒ©ç½šæè¿°",
      "position_config": {
        "columns": [9, 10],
        "positions": [3, 4]
      },
      "enabled": true
    }
  }
}
```

### æ–¹æ³•2ï¼šåˆ›å»ºé™·é˜±æ’ä»¶ç±»

1. **åˆ›å»ºæ’ä»¶æ–‡ä»¶** `src/plugins/your_new_trap.py`ï¼š

```python
from src.core.trap_plugin_system import TrapPluginBase

class YourNewTrap(TrapPluginBase):
    def __init__(self):
        super().__init__("æ‚¨çš„æ–°é™·é˜±", "è¿™æ˜¯ä¸€ä¸ªæ–°é™·é˜±")

    def get_character_quote(self) -> str:
        return "æ–°é™·é˜±çš„è§’è‰²å°è¯"

    def apply_first_time_penalty(self, player_id: str, session_id: str) -> dict:
        return {
            "type": "custom_penalty",
            "description": "é¦–æ¬¡è§¦å‘æƒ©ç½š",
            "score_penalty": 15
        }

    def apply_repeat_penalty(self, player_id: str, session_id: str) -> dict:
        return {
            "type": "score_penalty",
            "description": "é‡å¤è§¦å‘æƒ©ç½š",
            "amount": 10
        }
```

2. **æ³¨å†Œæ’ä»¶**ï¼š

```python
from src.core.trap_plugin_system import TrapManager
from src.plugins.your_new_trap import YourNewTrap

manager = TrapManager(use_enhanced_system=True)
plugin = YourNewTrap()
manager.register_plugin("æ‚¨çš„æ–°é™·é˜±", plugin)
```

---

## ğŸ”„ äº‹ä»¶ç³»ç»Ÿä½¿ç”¨

### å‘å¸ƒæ¸¸æˆäº‹ä»¶

```python
from src.core.event_system import emit_game_event, GameEventType

# å‘å¸ƒè‡ªå®šä¹‰äº‹ä»¶
emit_game_event(
    GameEventType.CUSTOM_EVENT,  # äº‹ä»¶ç±»å‹
    "player_id",                 # ç©å®¶ID
    {                           # äº‹ä»¶æ•°æ®
        "custom_data": "value",
        "score": 100
    },
    "session_id"                # ä¼šè¯IDï¼ˆå¯é€‰ï¼‰
)
```

### ç›‘å¬äº‹ä»¶

```python
from src.core.event_system import get_event_system, GameEventType

def my_event_handler(event):
    print(f"æ”¶åˆ°äº‹ä»¶: {event.event_type}, ç©å®¶: {event.player_id}")
    # å¤„ç†äº‹ä»¶é€»è¾‘

event_system = get_event_system()
event_system.subscribe(GameEventType.DICE_ROLLED, my_event_handler)
```

---

## ğŸ”§ é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ

### åœ¨GameServiceä¸­ä½¿ç”¨

```python
# æ›¿æ¢åŸæœ‰çš„æˆå°±ç³»ç»Ÿ
from src.core.achievement_manager import AchievementManager

class GameService:
    def __init__(self):
        # ä½¿ç”¨å¢å¼ºç³»ç»Ÿï¼ˆå‘åå…¼å®¹ï¼‰
        self.achievement_system = AchievementManager(use_enhanced_system=True)
        # åŸæœ‰æ¥å£ç»§ç»­å·¥ä½œ
        achievements = self.achievement_system.get_all_achievements()
```

### åœ¨æ¸¸æˆå¼•æ“ä¸­å‘å¸ƒäº‹ä»¶

```python
# åœ¨å…³é”®æ¸¸æˆæ“ä½œåå‘å¸ƒäº‹ä»¶
def roll_dice(self, session_id: str):
    # ... åŸæœ‰é€»è¾‘ ...

    # å‘å¸ƒäº‹ä»¶ï¼ˆè‡ªåŠ¨è§¦å‘æˆå°±æ£€æµ‹ï¼‰
    emit_game_event(GameEventType.DICE_ROLLED, player_id, {
        "dice_results": dice_results,
        "combinations": combinations
    })
```

---

## ğŸ“Š å®é™…ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæ·»åŠ "å¹¸è¿æ˜Ÿ"æˆå°±

```json
{
  "achievements": {
    "lucky_star": {
      "name": "â­ å¹¸è¿æ˜Ÿ",
      "description": "è¿ç»­5æ¬¡æ·å‡º6ä¸ªç›¸åŒæ•°å­—",
      "category": "CHALLENGE",
      "reward_description": "å¹¸è¿ç¬¦å’’ - ä¸‹æ¬¡æ·éª°ç»“æœ+1",
      "conditions": [
        {
          "type": "consecutive_same_dice",
          "count": 5
        }
      ]
    }
  }
}
```

### ç¤ºä¾‹2ï¼šæ·»åŠ "ä¼ é€é—¨"é™·é˜±

```json
{
  "plugins": {
    "ä¼ é€é—¨": {
      "plugin_class": "TeleportTrap",
      "name": "ä¼ é€é—¨",
      "description": "ç¥ç§˜çš„ä¼ é€é—¨å°†ä½ ä¼ é€åˆ°éšæœºä½ç½®",
      "character_quote": "æ¬¢è¿æ¥åˆ°...ç­‰ç­‰ï¼Œè¿™æ˜¯å“ªï¼Ÿ",
      "penalty_description": "éšæœºä¼ é€ï¼šå°†ä¸€ä¸ªä¸´æ—¶æ ‡è®°ç§»åŠ¨åˆ°éšæœºåˆ—çš„éšæœºä½ç½®",
      "position_config": {
        "columns": [6, 7, 14, 15],
        "positions": []
      },
      "enabled": true
    }
  }
}
```

---

## âš¡ å¿«é€Ÿå¼€å§‹

1. **æ·»åŠ æ–°æˆå°±**ï¼ˆæœ€ç®€å•ï¼‰ï¼š
   - ç¼–è¾‘ `config/achievements.json`
   - é‡å¯ç³»ç»Ÿ

2. **æ·»åŠ æ–°é™·é˜±**ï¼ˆéœ€è¦ç¼–ç¨‹ï¼‰ï¼š
   - ç¼–è¾‘ `config/trap_plugins.json`
   - åˆ›å»ºæ’ä»¶ç±»
   - æ³¨å†Œæ’ä»¶

3. **è‡ªå®šä¹‰äº‹ä»¶**ï¼š
   - åœ¨æ¸¸æˆé€»è¾‘ä¸­è°ƒç”¨ `emit_game_event`
   - è®¾ç½®å¯¹åº”çš„æˆå°±æ¡ä»¶

---

## ğŸ›¡ï¸ å‘åå…¼å®¹ä¿è¯

- âœ… æ‰€æœ‰ç°æœ‰æˆå°±ç»§ç»­æ­£å¸¸å·¥ä½œ
- âœ… æ‰€æœ‰ç°æœ‰é™·é˜±ç»§ç»­æ­£å¸¸å·¥ä½œ
- âœ… åŸæœ‰çš„APIæ¥å£ä¿æŒä¸å˜
- âœ… æ•°æ®åº“ç»“æ„æ— éœ€ä¿®æ”¹
- âœ… å¯ä»¥é€‰æ‹©ä½¿ç”¨åŸç³»ç»Ÿæˆ–å¢å¼ºç³»ç»Ÿ

---

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ–°æˆå°±ä¸è§¦å‘**
   - æ£€æŸ¥JSONè¯­æ³•æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤äº‹ä»¶ç±»å‹åç§°æ­£ç¡®
   - æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

2. **é™·é˜±æ’ä»¶æ— æ³•åŠ è½½**
   - ç¡®è®¤æ’ä»¶ç±»ç»§æ‰¿äº† `TrapPluginBase`
   - æ£€æŸ¥é…ç½®æ–‡ä»¶è·¯å¾„
   - ç¡®è®¤æ‰€æœ‰å¿…è¦æ–¹æ³•å·²å®ç°

3. **äº‹ä»¶ä¸è¢«å¤„ç†**
   - ç¡®è®¤ä½¿ç”¨äº†å¢å¼ºç³»ç»Ÿ
   - æ£€æŸ¥äº‹ä»¶è®¢é˜…æ˜¯å¦æ­£ç¡®
   - æŸ¥çœ‹äº‹ä»¶å†å²è®°å½•

### è°ƒè¯•å·¥å…·

```python
# æŸ¥çœ‹äº‹ä»¶å†å²
from src.core.event_system import get_event_system
event_system = get_event_system()
events = event_system.get_player_events("player_id")
print("ç©å®¶äº‹ä»¶:", events)

# æ£€æŸ¥æˆå°±çŠ¶æ€
manager = AchievementManager()
unlocked = manager.get_unlocked_achievements()
print("å·²è§£é”æˆå°±:", [a.name for a in unlocked])
```

---

## ğŸ¯ æœ€ä½³å®è·µ

1. **æˆå°±è®¾è®¡**ï¼š
   - æ¡ä»¶æ˜ç¡®ï¼Œæ˜“äºç†è§£
   - å¥–åŠ±æœ‰æ„ä¹‰ä¸”å¹³è¡¡
   - åˆ†ç±»åˆé€‚

2. **é™·é˜±è®¾è®¡**ï¼š
   - æƒ©ç½šæœ‰è¶£ä½†ä¸è¿‡åˆ†
   - é¦–æ¬¡å’Œé‡å¤æƒ©ç½šåŒºåˆ«æ˜æ˜¾
   - è§’è‰²å°è¯å¹½é»˜

3. **äº‹ä»¶ä½¿ç”¨**ï¼š
   - åœ¨åˆé€‚çš„æ—¶æœºå‘å¸ƒäº‹ä»¶
   - äº‹ä»¶æ•°æ®å®Œæ•´
   - é¿å…è¿‡åº¦å‘å¸ƒäº‹ä»¶

4. **é…ç½®ç®¡ç†**ï¼š
   - å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶
   - ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶
   - æµ‹è¯•é…ç½®å˜æ›´

ç°åœ¨æ‚¨å¯ä»¥è½»æ¾æ‰©å±•æ¸¸æˆå†…å®¹è€Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç ï¼ğŸ®