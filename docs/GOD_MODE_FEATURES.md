# 上帝模式 (God Mode) 功能说明

## 🎮 概述

上帝模式是CantStop游戏的管理界面，提供完整的游戏管理和监控功能。

## 🚀 启动方式

### Windows
```bash
start_gm.bat
```

### Python命令
```bash
python start_god_mode.py
```

## ✨ 主要功能

### 1. 玩家管理 (左侧面板)
- 📋 查看所有玩家列表
- ➕ 添加新玩家
- 💰 单个玩家积分修改
- 🔄 切换当前操作玩家
- 📊 查看玩家详细信息

### 2. 游戏地图 (中间面板)
- 🗺️ 实时显示所有玩家位置
- 🕳️ 显示陷阱位置
- 👁️ 查看永久标记和临时标记
- 🎨 区分不同玩家的颜色

### 3. 游戏控制 (中间下方)
- 🎲 掷骰子
- 🔢 选择数值组合
- 🏁 结束轮次
- 📍 设置陷阱
- 🔍 查看陷阱配置

### 4. GM总览 (右侧面板)
- 📊 游戏统计信息
- 👥 活跃玩家列表（含积分）
- 🎮 进行中的游戏数量
- 📋 详细信息显示

## 🛠️ 新增GM控制功能

### 💰 批量加积分
- **功能**: 给所有玩家统一添加积分
- **使用**: 点击 "💰 批量加积分" 按钮
- **参数**:
  - 积分数量 (1-10000)
  - 添加原因 (可选)
- **效果**: 所有玩家立即获得相同数量的积分

**使用场景**:
- 活动奖励
- 补偿积分
- 测试游戏

### 🕳️ 清除陷阱
- **功能**: 清除地图上所有陷阱
- **使用**: 点击 "🕳️ 清除陷阱" 按钮
- **警告**: 此操作不可恢复
- **效果**: 移除所有已生成的陷阱，玩家可以畅通无阻地移动

**使用场景**:
- 重置游戏环境
- 简化测试
- 临时移除障碍

### 🔍 检查积分
- **功能**: 验证积分系统是否正常工作
- **使用**: 点击 "🔍 检查积分" 按钮
- **检查项**:
  1. ✅ 积分是否为负数
  2. ✅ 玩家数据完整性
  3. ✅ 数据库与内存一致性
  4. 📊 所有玩家积分统计

**报告内容**:
- 检查玩家数
- 发现问题数
- 问题详细列表
- 所有玩家的当前积分

### 🔄 手动刷新
- **功能**: 立即刷新所有显示数据
- **使用**: 点击 "🔄 手动刷新" 按钮
- **自动刷新**: 每30秒自动刷新一次

### 📊 导出数据
- **功能**: 导出当前游戏状态到JSON文件
- **使用**: 点击 "📊 导出数据" 按钮
- **文件名**: `gm_overview_YYYYMMDD_HHMMSS.json`
- **内容**: 所有玩家状态、游戏统计、会话信息

## 🔐 数据持久化

### 自动保存
- ✅ 所有操作自动保存到数据库 (`cant_stop.db`)
- ✅ 重启程序不会丢失任何进度
- ✅ 玩家积分、游戏进度、临时标记全部保存

### 数据库位置
```
cant-stop-bot/
└── cant_stop.db    # SQLite数据库文件
```

### 保存内容
- 玩家信息（名称、阵营、积分）
- 游戏进度（永久标记、已登顶列）
- 游戏会话（临时标记、当前状态）
- 陷阱配置（位置、类型）

### 备份建议
定期备份 `cant_stop.db` 文件到安全位置。

## 📋 玩家积分列表

### 查看位置
右侧 "GM总览" 面板的玩家表格显示：
- 玩家名
- 阵营
- 状态（游戏中/空闲）
- **积分**（实时显示）
- 游戏进度
- 成就数
- 掷骰次数

### 更新频率
- 自动刷新: 每30秒
- 手动刷新: 点击刷新按钮
- 操作后刷新: 批量加积分后自动刷新

## 🎯 最佳实践

### 1. 开始游戏前
```
1. 启动上帝模式 GUI
2. 点击 "🔍 检查积分" 验证系统正常
3. 确认所有玩家都已注册
```

### 2. 活动奖励
```
1. 点击 "💰 批量加积分"
2. 输入奖励数量（如：500）
3. 输入原因（如：周年庆奖励）
4. 确认后所有玩家立即获得积分
```

### 3. 重置游戏环境
```
1. 点击 "🕳️ 清除陷阱" 移除所有陷阱
2. 在玩家管理中重置需要的玩家数据
3. 点击 "🔄 手动刷新" 确认状态
```

### 4. 定期维护
```
1. 每周使用 "🔍 检查积分" 验证系统
2. 每月导出数据备份
3. 定期备份 cant_stop.db 数据库文件
```

## ⚠️ 注意事项

### 重要提示
1. **数据安全**: 操作前确保数据库文件已备份
2. **不可恢复**: 清除陷阱、重置数据等操作不可恢复
3. **并发问题**: 同时运行多个上帝模式实例可能导致数据冲突
4. **权限管理**: 上帝模式具有完全控制权限，注意使用

### 常见问题

**Q: 重启后数据会丢失吗？**
A: 不会。所有数据自动保存到 `cant_stop.db` 数据库，重启后自动加载。

**Q: 批量加积分是否立即生效？**
A: 是的，操作完成后立即生效，并自动刷新显示。

**Q: 清除陷阱会影响玩家进度吗？**
A: 不会。只清除陷阱本身，不影响玩家的位置和进度。

**Q: 积分检查发现问题怎么办？**
A: 查看详细报告，根据问题类型使用相应的修复工具，或联系开发者。

**Q: 可以同时运行机器人和上帝模式吗？**
A: 可以，它们共享同一个数据库，操作会实时同步。

## 🔧 技术细节

### 数据刷新机制
- **GM总览**: 30秒自动刷新
- **游戏地图**: 1秒自动刷新（实时显示玩家移动）
- **手动刷新**: 立即更新所有数据

### 数据库操作
所有操作通过 `GameService` 进行，确保：
- ✅ 事务一致性
- ✅ 数据验证
- ✅ 错误处理
- ✅ 自动提交

### 积分系统检查逻辑
```python
1. 检查积分是否为负
2. 验证玩家数据完整性
3. 比对内存与数据库数据
4. 生成详细报告
```

## 📞 获取帮助

如遇问题：
1. 查看详细信息区域的错误提示
2. 使用 "🔍 检查积分" 诊断系统状态
3. 查看数据库文件是否存在且可访问
4. 参考项目文档或提交 Issue
